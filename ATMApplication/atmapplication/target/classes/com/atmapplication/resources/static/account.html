<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATM Interface</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #balance {
            font-size: 18px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>ATM Interface</h1>
    <div id="balance">Balance: $<span id="currentBalance">{{initialBalance}}</span></div>
    <h2>Deposit Funds</h2>
    <input type="number" id="depositAmount" placeholder="Enter deposit amount">
    <button onclick="deposit()">Deposit</button>
    
    <h2>Withdraw Funds</h2>
    <input type="number" id="withdrawAmount" placeholder="Enter withdrawal amount">
    <button onclick="withdraw()">Withdraw</button>

    
    <script>
       let balance;

// Extract the account number from the URL query parameters
const urlSearchParams = new URLSearchParams(window.location.search);
const loggedInAccountNumber = urlSearchParams.get("accountNumber");

// Fetch the account page for the logged-in account
fetch(`/account?accountNumber=${loggedInAccountNumber}`)
.then(response => response.text())
.then(html => {
    document.body.innerHTML = html;
    balance = parseFloat(document.getElementById("currentBalance").textContent); // Get the initial balance from the page
    updateBalance(); // Initialize the balance display
})
.catch(error => console.error('Error fetching account page:', error));


        function updateBalance() {
            document.getElementById("currentBalance").textContent = balance;
        }
        function deposit() {
    const depositAmount = parseFloat(document.getElementById("depositAmount").value);
    if (!isNaN(depositAmount) && depositAmount > 0) {
        fetch(`/deposit?accountNumber=${loggedInAccountNumber}&depositAmount=${depositAmount}`, {  //for now accountNumber = 1 because we dont have a session functionality yet
            method: "POST"
        })
        .then(response => response.text())
        .then(message => {
            if (message === "Deposited successfully") {
                balance += depositAmount;
                updateBalance();
                alert(`Deposited $${depositAmount}`);
            } else {
                alert("Account not found");
            }
        })
        .catch(error => console.error('Error depositing funds:', error));
    } else {
        alert("Invalid deposit amount");
    }
}

function withdraw() {
    const withdrawAmount = parseFloat(document.getElementById("withdrawAmount").value);
    if (!isNaN(withdrawAmount) && withdrawAmount > 0) {
        fetch(`/withdraw?accountNumber=${loggedInAccountNumber}&withdrawAmount=${withdrawAmount}`, {
            method: "POST"
        })
        .then(response => response.text())
        .then(message => {
            if (message === "Withdrawn successfully") {
                if (withdrawAmount <= balance) {
                    balance -= withdrawAmount;
                    updateBalance();
                    alert(`Withdrawn $${withdrawAmount}`);
                } else {
                    alert("Insufficient balance");
                }
            } else {
                alert("Account not found");
            }
        })
        .catch(error => console.error('Error withdrawing funds:', error));
    } else {
        alert("Invalid withdrawal amount");
    }
}

    updateBalance(); // Initialize the balance display
    </script>
</body>
</html>
